<include file="hair@public/head"/>

<header class='demos-header'>
    <h1 class="demos-title">付费开通</h1>
</header>
<div class="weui-form-preview">
    <div class="weui-form-preview__bd">
        <div class="weui-form-preview__item">
            <label class="weui-form-preview__label">名称</label>
            <span class="weui-form-preview__value">美发工具</span>
        </div>
        <div class="weui-form-preview__item">
            <label class="weui-form-preview__label">价格</label>
            <em class="weui-form-preview__value">200.00元</em>
        </div>
        <div class="weui-form-preview__item">
            <label class="weui-form-preview__label">说明</label>
            <span class="weui-form-preview__value">该工具为付费产品，必须支付后方能使用，一次付费终生使用。</span>
        </div>
    </div>
    <div class="weui-form-preview__ft">
        <a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" id="tool_pay">支付</a>
    </div>
</div>
<include file="hair@public/foot"/>
<script>
    $(function () {
        $(document).on("click", '#tool_pay', function () {
            $.confirm("", "确定支付", function () {
                $.post("{:url('hair/pay/getPreOrder')}", {}, function (ret) {
                    if (ret.code) {
                        if (typeof WeixinJSBridge == "undefined") {
                            if (document.addEventListener) {
                                document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
                            } else if (document.attachEvent) {
                                document.attachEvent('WeixinJSBridgeReady', jsApiCall);
                                document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
                            }
                        } else {
                            WeixinJSBridge.invoke(
                                'getBrandWCPayRequest', ret.data.pay_json,
                                function (res) {
                                    if (res.err_msg == "get_brand_wcpay_request:ok") {
                                        // todo  支付成功操作 跳转到下一页
                                        alert('支付成功');
                                        // window.location.href = 'some urls ';
                                    } else {
                                        //支付过程中用户取消或者 失败
                                        alert('支付失败');
                                    }
                                });
                        }
                    } else {
                        $.toast(ret.msg, "forbidden");
                    }
                }, 'json').error(function (err) {
                    console.log(err);
                });
            });
            return false;
        });
    });
</script>