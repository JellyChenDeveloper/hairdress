<include file="hair@public/head"/>
<style>
    body{background: #3e3e3e;}
    #add_page{
        background: #737373;
        color:#fff;
        border:2px solid #000;

    }
    .weui-cell_swiped>.weui-cell__bd{background: transparent;}
    .p-inner{
        background-color: #fff;
        border:2px solid #000;
        border-radius: 5px;
    }
    .p-name{
        text-align: center;
        border:1px solid #000;
        border-radius: 2px;
    }
    .weui-cell{margin-bottom: 5px;}
    .weui-cell:before{display: none;}
    .weui-cells:after, .weui-cells:before{display: none;}
    .weui-swiped-btn_warn,.weui-swiped-btn_default{background: #737373;border:1px solid #000;}
    .demos-title{background-color: #737373;border:2px solid #000;color:#fff;border-radius: 3px;}
</style>
<header class='demos-header'>
    <h1 class="demos-title">注册</h1>
</header>
<br>
<br>
<div class="weui-cells weui-cells_form">
    <div class="weui-cell weui-cell_vcode">
        <div class="weui-cell__hd"><label class="weui-label">手机号</label></div>
        <div class="weui-cell__bd">
            <input id="mobile" class="weui-input" type="tel" placeholder="请输入手机号" value="{$user.mobile}">
        </div>
        <div class="weui-cell__ft">
            <button class="weui-vcode-btn" id="get_sms_code">获取验证码</button>
        </div>
    </div>
    <div class="weui-cell">
        <div class="weui-cell__hd"><label class="weui-label">验证码</label></div>
        <div class="weui-cell__bd">
            <input id="sms_code" class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入验证码">
        </div>
    </div>
</div>
<div class="weui-cells weui-cells_form">
    <div class="weui-cell">
        <div class="weui-cell__hd"><label class="weui-label">邀请码</label></div>
        <div class="weui-cell__bd">
            <input id="activation_key" class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入邀请码" value="{$user.activation_key}">
        </div>
    </div>
    <input type="hidden" id="id" value="{$user.id}">
</div>
<div class="weui-btn-area">
    <a class="weui-btn weui-btn_primary" href="javascript:" id="showTooltips">确定</a>
</div>
<include file="hair@public/foot"/>
<script>
    $(function () {
        $("#showTooltips").click(function () {
            $.post("{:url('hair/index/doRegister')}", {
                mobile         : $('#mobile').val(),
                activation_key : $('#activation_key').val(),
                sms_code       : $('#sms_code').val(),
                id             : $('#id').val()
            }, function (ret) {
                if (ret.code) {
                    $.toast(ret.msg, 'success', function () {
                        window.location.href = ret.data.from_url;
                    });
                } else {
                    $.toast(ret.msg, "forbidden");
                }
            }, 'json').error(function (err) {
                console.log(err);
            });
        });


        $("#get_sms_code").click(function () {
            var InterValObj;
            var curCount = 60;
            var _this    = $(this);
            //设置button效果，开始计时
            _this.attr("disabled", "true");
            _this.html(curCount + " 秒");
            InterValObj = window.setInterval(function () {
                if (curCount == 0) {
                    window.clearInterval(InterValObj);//停止计时器
                    _this.removeAttr("disabled");//启用按钮
                    _this.html("获取验证码");
                }
                else {
                    curCount--;
                    _this.html(curCount + " 秒");
                }
            }, 1000); //启动计时器，1秒执行一次

            $.post("{:url('hair/index/sendSmsCode')}", {
                mobile : $('#mobile').val(),
                id     : $('#id').val()
            }, function (ret) {
                if (ret.code) {
                    $.toast(ret.msg, 'success');
                } else {
                    $.toast(ret.msg, "forbidden");
                }
            }, 'json').error(function (err) {
                console.log(err);
            });
        });
    });
</script>