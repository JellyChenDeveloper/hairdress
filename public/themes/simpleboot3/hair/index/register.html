<include file="hair@public/head"/>

<header class='demos-header'>
    <h1 class="demos-title">注册</h1>
</header>
<br>
<br>
<div class="weui-cells weui-cells_form">

    <!--
    <div class="weui-cell weui-cell_vcode">
        <div class="weui-cell__hd">
            <label class="weui-label">手机号</label>
        </div>
        <div class="weui-cell__bd">
            <input class="weui-input" type="tel" placeholder="请输入手机号">
        </div>
        <div class="weui-cell__ft">
            <button class="weui-vcode-btn">获取验证码</button>
        </div>
    </div>

    <div class="weui-cell">
        <div class="weui-cell__hd"><label class="weui-label">验证码</label></div>
        <div class="weui-cell__bd">
            <input class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入验证码">
        </div>
    </div>
    -->

    <div class="weui-cell">
        <div class="weui-cell__hd"><label class="weui-label">手机号</label></div>
        <div class="weui-cell__bd">
            <input id="mobile" class="weui-input" type="tel" placeholder="请输入手机号" value="{$user.mobile}">
        </div>
    </div>
    <div class="weui-cell">
        <div class="weui-cell__hd"><label class="weui-label">邀请码</label></div>
        <div class="weui-cell__bd">
            <input id="activation_key" class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入邀请码" value="{$user.activation_key}">
        </div>
    </div>
    <input type="hidden" id="user_id" value="{$user.id}">
</div>
<div class="weui-btn-area">
    <a class="weui-btn weui-btn_primary" href="javascript:" id="showTooltips">确定</a>
</div>
<include file="hair@public/foot"/>
<script>
    $(function () {
        $("#showTooltips").click(function () {
            var mobile = $('#mobile').val();
            if (!mobile || !/1[3|4|5|7|8]\d{9}/.test(mobile)) {
                $.toptip('请输入手机号');
                return false;
            }
            $.post("{:url('hair/index/doRegister')}", {
                mobile         : mobile,
                activation_key : $('#activation_key').val(),
                user_id        : $('#user_id').val()
            }, function (ret) {
                if (ret.code) {
                    $.toast(ret.msg, 'success', function () {
                        window.location.href = ret.data.from_url;
                    });
                } else {
                    $.toast(ret.msg, "forbidden");
                }
            }, 'json').error(function (err) {
                console.log(err);
            });
        });
    });
</script>