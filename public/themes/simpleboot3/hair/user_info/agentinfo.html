<include file="hair@public/head"/>

<div class="weui-panel__bd">

    <div class="weui-media-box weui-media-box_text">
        <h4 class="weui-media-box__title">提现</h4>
        <p class="weui-media-box__desc" style="-webkit-line-clamp:100">必须为1000的整数倍，每月只能申请提现3次，提现一般72小时内审批通过，提交提现申请时金额就从额度中减去，若审批通过后48小时内未到账，请联系管理员。</p>
        <br/>
        <p class="weui-media-box__desc" style="-webkit-line-clamp:100">提现之前必须设置银行卡信息，提现操作请注意核对信息，该操作可以覆盖不能撤销。</p>
    </div>

    <div class="weui-panel__bd">
        <div class="weui-panel__bd">
            <div class="weui-media-box weui-media-box_text">
                <p class="weui-media-box__desc">银行卡号：{$enc_bank_no}</p>
                <ul class="weui-media-box__info">
                    <li class="weui-media-box__info__meta">{$bank}</li>
                    <li class="weui-media-box__info__meta weui-media-box__info__meta_extra">{$enc_true_name}</li>
                </ul>
            </div>
            <div class="weui-media-box weui-media-box_small-appmsg">
                <div class="weui-cells">
                    <div class="weui-cell">
                        <div class="weui-cell__bd">
                            <p>总额度</p>
                        </div>
                        <div class="weui-cell__ft">{$total_money}</div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__bd">
                            <p>可提现额度</p>
                        </div>
                        <div class="weui-cell__ft">{$last_money}</div>
                    </div>
                    <a class="weui-cell weui-cell_access" href="{:url('hair/userInfo/paybackRecord')}">
                        <div class="weui-cell__bd">
                            <p>提现记录</p>
                        </div>
                        <div class="weui-cell__ft"></div>
                    </a>
                </div>

            </div>
        </div>
    </div>
</div>

<article class="weui-article">
    <input type="hidden" id="enc_bank_no" value="{$enc_bank_no}">
    <a href="{:url('hair/userInfo/bankInfo')}" class="weui-btn weui-btn_default" id="set_bank_info">设置银行卡</a>
    <a href="javascript:" class="weui-btn weui-btn_primary" id="transfer">提现</a>
</article>

<include file="hair@public/foot"/>
<script>
    $(function () {
        $(document).on("click", "#transfer", function () {
            if (!$('#enc_bank_no').val()) {
                $.toast('请设置银行卡', "forbidden");
                return;
            }
            $.prompt({
                title    : "请输入提现金额，1000的整数倍",
                onOK     : function (amount) {
                    if (!amount) {
                        $.toptip("请输入提现金额");
                        return false;
                    }

                    $.post("{:url('hair/UserInfo/postTransfer')}", {amount : amount}, function (ret) {
                        if (ret.code) {
                            $.toast(ret.msg, 'success', function () {
                                location.reload();
                            });
                        } else {
                            $.toast(ret.msg, "forbidden");
                        }
                    }, 'json').error(function (err) {
                        console.log(err);
                    });
                },
                onCancel : function () {
                    $.toast("{:lang('CANCEL')}", "cancel");
                    console.log("{:lang('CANCEL')}");
                },
                input    : "1000"
            });
        });
    });
</script>