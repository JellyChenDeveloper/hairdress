<include file="hair@public/head"/>
<style>
    body{background: #3e3e3e;}
    #add_project{
        background: #737373;
        color:#fff;
        border:2px solid #000;

    }
    .weui-cell_swiped>.weui-cell__bd{background: transparent;}
    .p-inner{
        background-color: #fff;
        border:2px solid #000;
        border-radius: 5px;
    }
    .p-name{
        text-align: center;
        border:1px solid #000;
        border-radius: 2px;
    }
    .weui-cell{margin-bottom: 5px;}
    .weui-cell:before{display: none;}
    .weui-cells:after, .weui-cells:before{display: none;}
    .weui-swiped-btn_warn{background: #737373;border:1px solid #000;}
</style>
<div class="bd">
    <div class='demos-content-padded'>
        <div class="button_sp_area" style="text-align: left;">
            <a href="javascript:" id='add_project' class="weui-btn weui-btn_mini weui-btn_primary">{:lang('NEW_PROJECT')}</a>
        </div>
    </div>
    <div class="weui-cells" style="padding:0 15px;background: transparent;">
        <foreach name="project_list" item="project">
            <div class="weui-cell weui-cell_swiped">
                <!--<div class="weui-cell__bd" style="transform: translateX(-136px)">-->
                <div class="weui-cell__bd ">
                    <div class="weui-cell p-inner">
                        <a class="weui-cell__bd" href="{:url('hair/project/detail','id='.$project.id)}">
                            <p class="p-name">{$project.name}</p>
                        </a>
                        <div class="weui-cell__ft left_word">向左滑动删除</div>
                    </div>
                </div>
                <div class="weui-cell__ft">
                    <a class="weui-swiped-btn weui-swiped-btn_warn delete_project" href="javascript:" data-id="{$project.id}">{:lang('DELETE')}</a>
                </div>
            </div>
        </foreach>
    </div>
</div>
<include file="hair@public/foot"/>
<script>
    $(function () {
        $(document).on("click", "#add_project", function () {
            $.prompt({
                title    : "{:lang('INPUT_PROJECT_NAME')}",
                onOK     : function (project_name) {
                    if (!project_name) {
                        $.toptip("{:lang('INPUT_PROJECT_NAME')}");
                        return false;
                    }

                    $.post("{:url('hair/project/doAddProj')}", {project_name : project_name}, function (ret) {
                        if (ret.code) {
                            $.toast(ret.msg, 'success', function () {
                                window.location.href = ret.url;
                            });
                        } else {
                            $.toast(ret.msg, "forbidden");
                        }
                    }, 'json').error(function (err) {
                        console.log(err);
                    });
                },
                onCancel : function () {
                    $.toast("{:lang('CANCEL')}", "cancel");
                    console.log("{:lang('CANCEL')}");
                }
            });
        });
        $(document).on("click", '.delete_project', function () {
            var _this     = $(this);
            var proj_item = _this.parents('.weui-cell_swiped');
            var proj_name = proj_item.find('a.weui-cell__bd p').text();

            $.confirm("{:lang('DELETE_PROJ_CONFIRM',['" + proj_name + "'])}", "{:lang('DELETE_CONFIRM')}", function () {
                $.post("{:url('hair/project/doDeleteProj')}", {project_id : _this.data('id')}, function (ret) {
                    if (ret.code) {
                        $.toast(ret.msg, 'success', function () {
                            proj_item.remove();
                        });
                    } else {
                        $.toast(ret.msg, "forbidden");
                    }
                }, 'json').error(function (err) {
                    console.log(err);
                });
            });
        })
    });
</script>